================================================================================
SIKOPMA CHEATSHEET - Command Cepat
================================================================================

ğŸ“¦ DEPLOY
--------------------------------------------------------------------------------
# Di Lokal (Persiapan)
composer install --no-dev --optimize-autoloader
npm install && npm run build

# Di Server (Setup Awal)
php artisan key:generate
php artisan migrate --seed --force
php artisan storage:link
chmod -R 775 storage bootstrap/cache
chmod 600 .env

# Di Server (Update)
php artisan migrate --force
php artisan config:cache
php artisan route:cache
php artisan queue:restart

================================================================================
ğŸ‘¥ USER MANAGEMENT
================================================================================

# Buat User Baru
php artisan tinker
$user = User::create(['nim'=>'12345678','name'=>'Nama','email'=>'email@x.com','password'=>bcrypt('pass123'),'status'=>'active']);
$user->assignRole('Anggota');

# Reset Password
php artisan tinker
User::where('nim','12345678')->first()->update(['password'=>bcrypt('newpass')]);

# Kirim Email Kredensial (1 user)
php artisan tinker
SendInitialCredentialsJob::dispatch(User::where('nim','12345678')->first(), 'password123');

# Kirim Email Kredensial (Semua user baru)
php artisan tinker
User::whereNull('last_login_at')->each(fn($u)=>SendInitialCredentialsJob::dispatch($u,'pass123'));

# Ganti Role
php artisan tinker
User::where('nim','12345678')->first()->syncRoles(['Ketua']);

# Nonaktifkan User
php artisan tinker
User::where('nim','12345678')->first()->update(['status'=>'inactive']);

================================================================================
ğŸ“§ EMAIL & QUEUE
================================================================================

# Test Email
php artisan tinker
Mail::raw('Test',fn($m)=>$m->to('test@email.com')->subject('Test'));

# Jalankan Queue
php artisan queue:work --sleep=3 --tries=3

# Queue Status
php artisan queue:failed          # Lihat failed jobs
php artisan queue:retry all       # Retry semua
php artisan queue:flush           # Hapus semua failed
php artisan queue:restart         # Restart worker

================================================================================
ğŸ—„ï¸ DATABASE
================================================================================

# Backup
mysqldump -u user -p database > backup_$(date +%Y%m%d).sql

# Restore
mysql -u user -p database < backup.sql

# Reset (HATI-HATI!)
php artisan migrate:fresh --seed --force

# Query Data
php artisan tinker
User::all();
User::where('nim','12345678')->first();
Product::count();

================================================================================
ğŸ”§ MAINTENANCE
================================================================================

# Clear Cache
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# Rebuild Cache
php artisan config:cache
php artisan route:cache

# Maintenance Mode
php artisan down                  # Tutup sementara
php artisan up                    # Buka lagi

# Check Status
php artisan db:show               # Database
php artisan route:list            # Routes
php artisan queue:monitor         # Queue

# Logs
tail -f storage/logs/laravel.log
tail -50 storage/logs/laravel.log

================================================================================
ğŸ› TROUBLESHOOTING
================================================================================

# Error: No encryption key
php artisan key:generate

# Error: Permission denied
chmod -R 775 storage bootstrap/cache

# Error: Class not found
composer dump-autoload

# Error: CSRF token
php artisan config:clear && php artisan cache:clear

# Error: 500 Internal
tail -50 storage/logs/laravel.log
php artisan optimize:clear

# Queue tidak jalan
php artisan queue:restart
pkill -f "queue:work" && php artisan queue:work &

================================================================================
ğŸ“Š MONITORING
================================================================================

# Disk Space
du -sh storage/logs/
rm storage/logs/laravel-*.log     # Hapus old logs

# Database Size
php artisan tinker
DB::select("SELECT table_name, ROUND(((data_length + index_length) / 1024 / 1024), 2) AS 'Size (MB)' FROM information_schema.TABLES WHERE table_schema = 'database_name'");

# Active Users
php artisan tinker
User::where('status','active')->count();

# Recent Activity
php artisan tinker
ActivityLog::latest()->take(10)->get();

================================================================================
ğŸ” SECURITY
================================================================================

# Ganti APP_KEY
cp .env .env.backup
php artisan key:generate

# Check Config
cat .env | grep APP_DEBUG          # Harus false
cat .env | grep APP_ENV            # Harus production

# File Permissions
ls -la .env                        # Harus 600
ls -ld storage                     # Harus 775

================================================================================
âš¡ QUICK FIXES
================================================================================

# Aplikasi Error
php artisan optimize:clear
composer dump-autoload
php artisan config:cache

# Queue Stuck
php artisan queue:restart

# Cache Issue
php artisan cache:clear
php artisan config:clear

# Database Issue
php artisan migrate:status
php artisan migrate --force

================================================================================
ğŸ“ DAILY ROUTINE
================================================================================

# Pagi
tail -50 storage/logs/laravel.log
php artisan queue:failed

# Siang
php artisan cache:clear (jika perlu)
php artisan queue:restart (jika stuck)

# Malam
mysqldump -u user -p db > backup_$(date +%Y%m%d).sql

================================================================================
